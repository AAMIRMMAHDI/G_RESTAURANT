<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل مدیریت کاربران رستوران</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap');
        :root { --primary: #4361EE; --primary-dark: #3A56D4; --secondary: #7209B7; --success: #4CAF50; --warning: #FF9800; --danger: #F44336; --dark: #2B2D42; --light: #F8F9FA; --gray: #8D99AE; --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); --shadow: 0 10px 30px rgba(0,0,0,0.08); --radius: 12px; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Vazirmatn', sans-serif; }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%); color: var(--dark); min-height: 100vh; padding: 1rem; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { background: linear-gradient(135deg, var(--dark), #1A1C2E); color: white; padding: 1.5rem 2rem; border-radius: var(--radius); box-shadow: var(--shadow); margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon { width: 50px; height: 50px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .user-info { display: flex; align-items: center; gap: 1rem; background: rgba(255,255,255,0.1); padding: 0.7rem 1.2rem; border-radius: 50px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; }
        .stats-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: white; border-radius: var(--radius); padding: 1.5rem; box-shadow: var(--shadow); display: flex; align-items: center; gap: 1rem; transition: var(--transition); }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-icon { width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; color: white; }
        .stat-icon.primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); }
        .stat-icon.success { background: linear-gradient(135deg, var(--success), #388E3C); }
        .main-content { display: grid; grid-template-columns: 1fr 400px; gap: 2rem; }
        @media (max-width: 992px) { .main-content { grid-template-columns: 1fr; } }
        .users-section { background: white; border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; }
        .section-header { padding: 1.5rem; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .btn { padding: 0.7rem 1.5rem; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; }
        .users-table { width: 100%; border-collapse: collapse; }
        .users-table th { background: #f8f9fa; padding: 1rem; text-align: right; }
        .users-table td { padding: 1rem; border-bottom: 1px solid #eee; }
        .user-avatar-small { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9rem; }
        .status-badge { padding: 0.4rem 0.8rem; border-radius: 50px; font-size: 0.8rem; font-weight: 600; }
        .status-active { background: rgba(76, 175, 80, 0.1); color: var(--success); }
        .role-badge { padding: 0.4rem 0.8rem; border-radius: 50px; font-size: 0.8rem; font-weight: 600; }
        .role-manager { background: rgba(67, 97, 238, 0.1); color: var(--primary); }
        .action-buttons { display: flex; gap: 0.5rem; }
        .btn-sm { padding: 0.5rem 0.8rem; font-size: 0.8rem; }
        .form-section { background: white; border-radius: var(--radius); box-shadow: var(--shadow); padding: 1.5rem; position: sticky; top: 2rem; }
        .form-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem; }
        .form-group { margin-bottom: 1.2rem; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--dark); }
        .form-control, .form-select { width: 100%; padding: 0.9rem 1rem; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s; }
        .form-control:focus, .form-select:focus { border-color: var(--primary); outline: none; }
        .form-textarea { min-height: 100px; resize: vertical; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .submit-btn { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border: none; width: 100%; padding: 1rem; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; margin-top: 1rem; transition: var(--transition); }
        .submit-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(67,97,238,0.3); }
        .tabs { display: flex; border-bottom: 1px solid #eee; margin-bottom: 1rem; }
        .tab-btn { padding: 1rem 2rem; background: none; border: none; cursor: pointer; font-weight: 600; position: relative; transition: color 0.3s; }
        .tab-btn.active { color: var(--primary); }
        .tab-btn.active:after { content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px; background: var(--primary); }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-users"></i></div>
                <div class="logo-text">پنل مدیریت کاربران</div>
            </div>
            <div class="user-info">
                <div class="user-avatar">{{ request.user.first_name|slice:":1" }}</div>
                <div class="user-details">
                    <div class="user-name">{{ request.user.get_full_name }}</div>
                    <div class="user-role">مدیر رستوران</div>
                </div>
            </div>
        </header>

        <div class="stats-cards">
            <div class="stat-card"><div class="stat-icon primary"><i class="fas fa-users"></i></div><div class="stat-info"><div class="stat-value">{{ users.count }}</div><div class="stat-label">کل کارکنان</div></div></div>
            <div class="stat-card"><div class="stat-icon success"><i class="fas fa-user-check"></i></div><div class="stat-info"><div class="stat-value">{{ active_count }}</div><div class="stat-label">فعال</div></div></div>
            <div class="stat-card"><div class="stat-icon warning"><i class="fas fa-user-clock"></i></div><div class="stat-info"><div class="stat-value">{{ inactive_count }}</div><div class="stat-label">غیرفعال</div></div></div>
            <div class="stat-card"><div class="stat-icon danger"><i class="fas fa-user-slash"></i></div><div class="stat-info"><div class="stat-value">{{ suspended_count }}</div><div class="stat-label">تعلیق شده</div></div></div>
        </div>

        <div class="main-content">
            <div class="left-column">
                <div class="users-section">
                    <div class="section-header">
                        <h2 class="section-title">لیست کاربران</h2>
                        <button class="btn btn-primary" onclick="location.reload()">بروزرسانی</button>
                    </div>
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="staff">کارکنان رستوران</button>
                        <button class="tab-btn" data-tab="customers">مشتریان</button>
                    </div>
                    <table class="users-table">
                        <thead>
                            <tr><th>کاربر</th><th>موبایل</th><th>سمت</th><th>وضعیت</th><th>عملیات</th></tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                            <tr data-tab="{% if user.role == 'customer' %}customers{% else %}staff{% endif %}">
                                <td>
                                    <div class="user-info-cell">
                                        <div class="user-avatar-small" style="background:#4361EE">{{ user.first_name|slice:":1" }}{{ user.last_name|slice:":1" }}</div>
                                        <div>
                                            <div class="user-name">{{ user.get_full_name }}</div>
                                            <div class="user-role">{{ user.mobile }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td>{{ user.mobile }}</td>
                                <td><span class="role-badge role-{{ user.role }}">{{ user.get_role_display }}</span></td>
                                <td><span class="status-badge status-{{ user.status }}">{{ user.get_status_display }}</span></td>
                                <td class="action-buttons">
                                    <form method="post" style="display:inline">
                                        {% csrf_token %}
                                        <input type="hidden" name="edit_user" value="{{ user.id }}">
                                        <button type="submit" class="btn btn-warning btn-sm">ویرایش</button>
                                    </form>
                                    <form method="post" style="display:inline" onsubmit="return confirm('آیا مطمئنید؟')">
                                        {% csrf_token %}
                                        <input type="hidden" name="delete_user" value="{{ user.id }}">
                                        <button type="submit" class="btn btn-danger btn-sm">حذف</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="form-section">
                <h2 class="form-title">افزودن/ویرایش کاربر</h2>
                <form method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <label class="form-label" for="{{ form.first_name.id_for_label }}">نام</label>
                        <input type="text" class="form-control" id="{{ form.first_name.id_for_label }}" name="{{ form.first_name.name }}" value="{{ form.first_name.value|default:'' }}" placeholder="نام">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="{{ form.last_name.id_for_label }}">نام خانوادگی</label>
                        <input type="text" class="form-control" id="{{ form.last_name.id_for_label }}" name="{{ form.last_name.name }}" value="{{ form.last_name.value|default:'' }}" placeholder="نام خانوادگی">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="{{ form.national_code.id_for_label }}">کد ملی</label>
                        <input type="text" class="form-control" id="{{ form.national_code.id_for_label }}" name="{{ form.national_code.name }}" value="{{ form.national_code.value|default:'' }}" placeholder="کد ملی">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="{{ form.mobile.id_for_label }}">موبایل</label>
                        <input type="text" class="form-control" id="{{ form.mobile.id_for_label }}" name="{{ form.mobile.name }}" value="{{ form.mobile.value|default:'' }}" placeholder="موبایل">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="{{ form.email.id_for_label }}">ایمیل</label>
                        <input type="email" class="form-control" id="{{ form.email.id_for_label }}" name="{{ form.email.name }}" value="{{ form.email.value|default:'' }}" placeholder="ایمیل">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="{{ form.birth_date.id_for_label }}">تاریخ تولد</label>
                            <input type="date" class="form-control" id="{{ form.birth_date.id_for_label }}" name="{{ form.birth_date.name }}" value="{{ form.birth_date.value|default:'' }}">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="{{ form.hire_date.id_for_label }}">تاریخ استخدام</label>
                            <input type="date" class="form-control" id="{{ form.hire_date.id_for_label }}" name="{{ form.hire_date.name }}" value="{{ form.hire_date.value|default:'' }}">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="{{ form.role.id_for_label }}">نقش</label>
                            <select class="form-select" id="{{ form.role.id_for_label }}" name="{{ form.role.name }}">
                                {% for choice in form.role.field.choices %}
                                    <option value="{{ choice.0 }}" {% if form.role.value == choice.0 %}selected{% endif %}>{{ choice.1 }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="{{ form.status.id_for_label }}">وضعیت</label>
                            <select class="form-select" id="{{ form.status.id_for_label }}" name="{{ form.status.name }}">
                                {% for choice in form.status.field.choices %}
                                    <option value="{{ choice.0 }}" {% if form.status.value == choice.0 %}selected{% endif %}>{{ choice.1 }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="{{ form.address.id_for_label }}">آدرس</label>
                        <textarea class="form-control form-textarea" id="{{ form.address.id_for_label }}" name="{{ form.address.name }}" placeholder="آدرس">{{ form.address.value|default:'' }}</textarea>
                    </div>
                    <button type="submit" class="submit-btn">
                        {% if form.instance.pk %}ویرایش{% else %}ذخیره{% endif %} اطلاعات
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // مدیریت تب‌ها
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const tab = this.dataset.tab;
                document.querySelectorAll('.users-table tbody tr').forEach(row => {
                    row.style.display = (row.dataset.tab === tab) ? '' : 'none';
                });
            });
        });

        // نمایش اولیه کارکنان
        document.querySelector('.tab-btn[data-tab="staff"]').click();
    </script>
</body>
</html>